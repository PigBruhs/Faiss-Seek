# 登录

### 前端代码：

 axios
        .post("http://localhost:19198/login", loginData)
        .then((response) => {
          if (response.data && response.data.success) {
            this.$emit("set-message", "登录成功！", "success");
            response.data.userId = this.userId; // 获取用户名
            localStorage.setItem("userId", this.userId); // 将用户名存储
            localStorage.setItem("token", response.data.token); // 将用户标识存储
            localStorage.setItem("role", response.data.role); // 将用户组存储
            this.$router.push({ path: "/UserInfo" }); // 登录成功后跳转到主页并传入用户名参数
          } else {
            this.$emit("set-message", response.data.message || "登录失败", "error");
          }
        })
        .catch((error) => {
          if (error.response) {
            this.$emit("set-message", error.response.data.message || "登录失败", "error");
          } else {
            this.$emit("set-message", "网络错误，请稍后重试", "error");
          }
        });

### 发送端口

http://localhost:19198/login

### 发送数据

loginData:
const loginData = {
        userId: this.userId,
        password: this.password,
      };
      例如：
      const loginData = {
  userId: "zhangsan",
  password: "123456"
};

### 要求返回数据：

response.data
{
  "success": true,           // 是否登录成功，布尔值
  "message": "登录成功！",    // 提示信息（可以不用）
  "token": "xxxxxxx",        // 用户身份标识（JWT等,每次登录生成，唯一）
  "role": "user",            // 用户角色（如 user、admin 等,这里先只考虑用户user）
  "userId": "zhangsan"       // 用户名
}

# 注册

### 前端代码

axios
        .post("http://localhost:19198/register", registerData)
        .then((response) => {
          if (response.data.success) {
           this.$emit("set-message", "注册成功！", "success");
                        this.$router.push("/Login");
          } else {
            this.$emit("set-message", response.data.message || "注册失败", "error");
          }
        })
        .catch((error) => {
          console.error("注册请求失败:", error);
          this.$emit("set-message", "注册请求失败，请稍后重试", "error");
        });
    },

### 发送端口

http://localhost:19198/register

### 发送数据

const registerData = {
        userId: this.userId,
        password: this.password,
      };

### 要求返回数据：

response.data
{
  "success": true,           // 是否注册成功，布尔值
  "message": "注册成功！",    // 提示信息（如注册成功或失败原因）

# 上传图片

### 前端代码：

asyncmatchImage() {

 if(!this.imageFile)return;

    constformData=newFormData();

    formData.append("image", this.imageFile);

    try {

    // 获取 token

    consttoken=localStorage.getItem("token");

    // POST 请求发送图片，附带 token

    constres=awaitaxios.post("http://localhost:19198/match", formData, {

    headers: {

    "Content-Type":"multipart/form-data",

    "Authorization":`Bearer ${token}`, // 添加 token 到请求头

    },

    });

    // 假设后端返回的数据格式为 { images: [...] }

    this.imageList=res.data.images||[];

    this.$emit("set-message", "图片获取成功", "success");

    } catch(err) {

    this.$emit("set-message", "图片获取失败", "error");

    }

    },

### 发送端口

http://localhost:19198/match

### 发送数据

请求头携带token

"Content-Type":"multipart/form-data"

示例：

Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="image"; filename="example.jpg"
Content-Type: image/jpeg

<这里是图片的二进制内容>
------WebKitFormBoundary7MA4YWxkTrZu0gW--

### 后端接受请求示例

@app.route('/match', methods=['POST'])

defmatch():

    # 获取 Authorization 请求头

    auth_header = request.headers.get('Authorization')

    ifnot auth_header ornot auth_header.startswith("Bearer "):

    returnjsonify({"success": False, "message": "缺少或无效的令牌"}), 401

    token = auth_header.split(" ")[1]  # 提取 token

    # 验证 token（示例代码，实际需要根据你的逻辑验证 token）

    if token !="xxxxxxx":  # 替换为你的 token 验证逻辑

    returnjsonify({"success": False, "message": "令牌无效"}), 401

    # 处理图片匹配逻辑

    returnjsonify({"success": True, "images": ["image1.jpg", "image2.jpg"]})

    # 获取上传的图片文件，字段名要和前端 formData.append("image", file) 一致

    file = request.files.get('image')

    if file:

    # 保存图片到本地（可选）

    file.save('uploads/'+ file.filename)

    return {'success': True, 'message': '图片接收成功', 'filename': file.filename}

### 要求返回数据

{

  "success": true,            // 是否成功，布尔值

  "images": [                 // 匹配到的图片列表（可以是图片URL、Base64或其它标识，具体你选择）

    "http://example.com/img1.jpg",

    "http://example.com/img2.jpg"

  ],

  "message": "图片获取成功"     // 可选，提示信息，比如已匹配多少张图片

}

# token验证

### 前端代码

async checkTokenValidity() {

    consttoken=localStorage.getItem("token");

    if(!token) {

    this.$router.push({ path:"/Login" });

    return;

    }

    try {

    constresponse=awaitaxios.get("http://localhost:19198/protected", {

    headers: { Authorization:token },

    });

    // 根据 response.data.success 判断

    if(!response.data.success) {

    console.error("Token 验证失败:", response.data.message);

    this.setMessage(response.data.message||"Token 验证失败", "error");

    localStorage.removeItem("token");

    localStorage.removeItem("userId"); // 清除用户 ID

    localStorage.removeItem("role"); // 清除用户组

    this.$router.push({ path:"/Login" });

    }

    } catch(error) {

    if(!error.response) {

    console.error("网络错误:", error);

    this.setMessage("网络连接失败，请检查您的网络", "error");

    } else {

    console.error("Token 验证失败:", error.response.data.message);

    this.setMessage(error.response.data.message||"Token 验证失败", "error");

    }

    localStorage.removeItem("token");

    localStorage.removeItem("userId"); // 清除用户 ID

    localStorage.removeItem("role"); // 清除用户组

    this.$router.push({ path:"/Login" });

    }

}

### 发送端口

http://localhost:19198/protected

### 发送数据：

无（只需要在请求头中附带 `Authorization` 字段）

{

  "Authorization": "Bearer `<token>`"// 用户登录时获取的 token

}

### 要求返回数据

{

  "success": true,           // 是否验证成功，布尔值

  "message": "Token 验证成功"// 提示信息（如验证成功或失败原因）

}
